<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:viewmodels="clr-namespace:TwoFactorAuth.ViewModels"
        x:Class="TwoFactorAuth.Views.Dialogs.ImportBackupDialog"
        x:DataType="viewmodels:ImportBackupDialogViewModel"
        Width="550"
        MinWidth="500"
        MaxWidth="700"
        MinHeight="400"
        MaxHeight="800"
        SizeToContent="Height"
        Title="{DynamicResource Lang.Backup.ImportTitle}"
        WindowStartupLocation="CenterOwner"
        CanResize="True">
    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="24" Spacing="16">
        <TextBlock Text="{DynamicResource Lang.Backup.ImportDescription}" 
                   TextWrapping="Wrap" 
                   Opacity="0.8"/>

        <Border BorderBrush="{DynamicResource SemiColorBorder}" 
                BorderThickness="1" 
                CornerRadius="6" 
                Padding="16" 
                Background="{DynamicResource SemiColorBackground1}">
            <StackPanel Spacing="8">
                <TextBlock Text="{DynamicResource Lang.Backup.BackupInfo}" 
                           FontWeight="SemiBold" 
                           FontSize="14"/>
                <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto,Auto,Auto,Auto" RowSpacing="6">
                    <TextBlock Grid.Row="0" Grid.Column="0" Text="{DynamicResource Lang.Backup.BackupTime}" Opacity="0.7" Margin="0,0,12,0"/>
                    <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding BackupTimestamp}"/>
                    
                    <TextBlock Grid.Row="1" Grid.Column="0" Text="{DynamicResource Lang.Backup.AccountCount}" Opacity="0.7" Margin="0,0,12,0"/>
                    <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding AccountCount}"/>
                    
                    <TextBlock Grid.Row="2" Grid.Column="0" Text="{DynamicResource Lang.Backup.CategoryCount}" Opacity="0.7" Margin="0,0,12,0"/>
                    <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding CategoryCount}"/>
                    
                    <TextBlock Grid.Row="3" Grid.Column="0" Text="{DynamicResource Lang.Backup.AppVersion}" Opacity="0.7" Margin="0,0,12,0"/>
                    <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding AppVersion}"/>
                </Grid>
            </StackPanel>
        </Border>

        <StackPanel Spacing="8">
            <TextBlock Text="{DynamicResource Lang.Backup.BackupPassword}" FontWeight="SemiBold"/>
            <TextBox Name="PasswordBox" 
                     PasswordChar="â€¢" 
                     Watermark="{DynamicResource Lang.Backup.EnterPasswordWatermark}"/>
        </StackPanel>

        <StackPanel Spacing="8">
            <TextBlock Text="{DynamicResource Lang.Backup.ImportMode}" FontWeight="SemiBold"/>
            <StackPanel Orientation="Horizontal" Spacing="8">
                <PathIcon Data="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z" Width="16" Height="16" Foreground="{DynamicResource SemiColorSuccess}" VerticalAlignment="Center"/>
                <RadioButton GroupName="ImportMode" 
                             IsChecked="{Binding IsMergeMode}" 
                             Content="{DynamicResource Lang.Backup.MergeMode}"
                             VerticalAlignment="Center"/>
            </StackPanel>
            <TextBlock Text="{DynamicResource Lang.Backup.MergeModeDesc}" 
                       FontSize="11" 
                       Opacity="0.6" 
                       Margin="28,0,0,8" 
                       TextWrapping="Wrap"/>
            
            <StackPanel Orientation="Horizontal" Spacing="8">
                <PathIcon Data="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z" Width="16" Height="16" Foreground="{DynamicResource SemiColorWarning}" VerticalAlignment="Center"/>
                <RadioButton GroupName="ImportMode" 
                             IsChecked="{Binding !IsMergeMode}" 
                             Content="{DynamicResource Lang.Backup.OverwriteMode}"
                             VerticalAlignment="Center"/>
            </StackPanel>
            <TextBlock Text="{DynamicResource Lang.Backup.OverwriteModeDesc}" 
                       FontSize="11" 
                       Opacity="0.6" 
                       Margin="28,0,0,0" 
                       TextWrapping="Wrap"/>
        </StackPanel>

        <StackPanel Spacing="8" IsVisible="{Binding IsMergeMode}">
            <TextBlock Text="{DynamicResource Lang.Backup.ConflictStrategy}" FontWeight="SemiBold"/>
            <ComboBox SelectedIndex="{Binding ConflictStrategyIndex}" HorizontalAlignment="Stretch">
                <ComboBoxItem Content="{DynamicResource Lang.Backup.ConflictSkip}"/>
                <ComboBoxItem Content="{DynamicResource Lang.Backup.ConflictOverwrite}"/>
                <ComboBoxItem Content="{DynamicResource Lang.Backup.ConflictRename}"/>
            </ComboBox>
        </StackPanel>

        <Border BorderBrush="{DynamicResource SemiColorDanger}" 
                BorderThickness="1" 
                CornerRadius="6" 
                Padding="12" 
                Background="{DynamicResource SemiColorDangerBackground}"
                IsVisible="{Binding !IsMergeMode}">
            <StackPanel Spacing="4">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <PathIcon Data="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z" Width="16" Height="16" Foreground="{DynamicResource SemiColorDanger}" VerticalAlignment="Center"/>
                    <TextBlock Text="{DynamicResource Lang.Backup.OverwriteWarningTitle}" 
                               FontWeight="SemiBold" 
                               Foreground="{DynamicResource SemiColorDanger}"
                               VerticalAlignment="Center"/>
                </StackPanel>
                <TextBlock Text="{DynamicResource Lang.Backup.OverwriteWarning}" 
                           FontSize="12" 
                           TextWrapping="Wrap"/>
            </StackPanel>
        </Border>

        <TextBlock Text="{Binding ErrorMessage}" 
                   Foreground="{DynamicResource SemiColorDanger}" 
                   TextWrapping="Wrap" 
                   IsVisible="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>

        <WrapPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,8,0,0">
            <Button Content="{DynamicResource Lang.Cancel}" 
                    Click="OnCancelClick" 
                    Margin="0,0,12,0"/>
            <Button Content="{DynamicResource Lang.Backup.Import}" 
                    Click="OnImportClick" 
                    Classes="Primary"/>
        </WrapPanel>
    </StackPanel>
    </ScrollViewer>
</Window>
